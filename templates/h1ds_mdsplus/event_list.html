{% extends "h1ds_mdsplus/mdsplus_base.html" %}

{% block mdscontent %}


<table class="event-list">
<tr>
<th class="event-id">id</th>
<th>Name</th>
<th>Data</th>
<th>Time</th>
</tr>
{% for event in events %}
<tr class="update-row">
<td class="event-id">{{event.id}}</td>
<td class="name">{{event.name}}</td>
<td class="data">{{event.data}}</td>
<td class="time">{{event.time|date:"Y-m-d H:i:s"}}</td>
</tr>
{% endfor %}
</table>

{% endblock %}

{% block extrascript %}
<script>
function updateEvents() {
 $.getJSON('/mdsplus/events/', function(data){
  $.each(data, function(eventID) {
   var topRowId=parseInt($(".event-id").eq(1).text());
   if (parseInt(data[eventID].pk) > topRowId) {
    $("tr").eq(0).after('<tr><td class="event-id">'+data[eventID].pk+'</td><td class="name">'+data[eventID].fields.name+'</td><td class="data">'+data[eventID].fields.data+'</td><td class="time">'+data[eventID].fields.time+'</td></tr>');
    $("tr").eq(1).effect("highlight", {color:"#ff6600"}, 300000);
   } // end if
  }); // end each
 }); // end getJSON
} // end function

function autoUpdate() {
setInterval(updateEvents, 2000);
}

$(document).ready(function() {
autoUpdate();
});
</script>
{% endblock %}
