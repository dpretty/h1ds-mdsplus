{% extends "h1ds_mdsplus/mdsplus_base.html" %}

{% load templatetable %}
{% block leftpanel %}

{% if input_tree %}
<h3>latest <span id="mds-nav-treename">{{input_tree}}</span> shot: <span class="latest_shot"></span></h3>
{% endif %}

{% comment %}
<div id="mdsplus-breadcrumb">
 <p>{% ifequal shot "-1" %} MDSplus template (shot -1){% else %}{% ifequal shot "0" %}latest shot (<span id="mds-nav-shot" class="latest_shot">{{shot}}</span>){% else %}<a href="{% url mds-node input_tree shot|add:'-1' input_path %}{% if input_query%}?{{input_query}}{% endif %}"> {{shot|add:'-1'}} </a>  < <span id="mds-nav-shot">{{shot}}</span> > <a href="{% url mds-node input_tree shot|add:'1' input_path %}{% if input_query%}?{{input_query}}{% endif %}"> {{shot|add:'1'}}</a> {% endifequal %}{% endifequal %}</p> 
</div>
{% endcomment %}
<div id="request-shot">
<FORM action="{% url mds-request-shot %}" method="post">{% csrf_token %}
    <span class="left"><LABEL for="requested-shot">go to shot</LABEL></span>
    <span class="right">
    <INPUT type="hidden" name="input-path" value="{{input_path}}">
    <INPUT type="hidden" name="input-tree" value="{{input_tree}}">
    <INPUT type="hidden" name="input-query" value="{{input_query}}">
    <INPUT type="text" size=5 id="requested-shot" name="requested-shot">
    <INPUT title="go to shot" type="submit" value=">"></span>
 </FORM>
</div>


<ul class="mds-tree">
{% for b in breadcrumbs %}{% if not forloop.last %}<li class="mds-node-item unpopulated"><span class="mds-node-name"><a href="{{b.1}}">{{b.0}}</a></span>{% else %}<li>{{b.0}}{% endif %}<span class="mds-node-id">{{b.2}}</span><span class="mds-node-tree">{{b.3}}</span></li>{% endfor %}
</ul>

<h3>children</h3>
<table width="100%" class="side-table">
  {% table item children 2 %}
  {% if table.startrow %}
  {% if table.oddrow %}
  <tr class="highlight">
    {% else %}
  <tr>
    {% endif %}
    {% endif %}
    {% if table.lastcellinrow %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}cellAutoAdjust">
      {% else %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}left cellAutoAdjust">
      {% endif %}
      <div class="options displayNone"></div>
      <a href="{{item.1}}">{{item.0}}</a>
    </td>
    {% if table.endrow %}
  </tr>
  {% endif %}
  {% endtable %}
</table>

<h3>members</h3>
<table width="100%" class="side-table">
  {% table item members 2 %}
  {% if table.startrow %}
  {% if table.oddrow %}
  <tr class="highlight">
    {% else %}
  <tr>
    {% endif %}
    {% endif %}
    {% if table.lastcellinrow %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}cellAutoAdjust">
      {% else %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}left cellAutoAdjust">
      {% endif %}
      <div class="options displayNone"></div>
      <a href="{{item.1}}">{{item.0}}</a>
    </td>
    {% if table.endrow %}
  </tr>
  {% endif %}
  {% endtable %}
</table>

<h3>tags</h3>
<table width="100%" class="side-table">
  {% table item tagnames 2 %}
  {% if table.startrow %}
  {% if table.oddrow %}
  <tr class="highlight">
    {% else %}
  <tr>
    {% endif %}
    {% endif %}
    {% if table.lastcellinrow %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}cellAutoAdjust">
      {% else %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}left cellAutoAdjust">
      {% endif %}
      <div class="options displayNone"></div>
      <a href="{{item.1}}">{{item.0}}</a>
    </td>
    {% if table.endrow %}
  </tr>
  {% endif %}
  {% endtable %}
</table>

<h3>trees</h3>
<table width="100%" class="side-table">
  {% table item treelinks 2 %}
  {% if table.startrow %}
  {% if table.oddrow %}
  <tr class="highlight">
    {% else %}
  <tr>
    {% endif %}
    {% endif %}
    {% if table.lastcellinrow %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}cellAutoAdjust">
      {% else %}
    <td class="{% if table.oddrow %}highlightableCell {% endif %}left cellAutoAdjust">
      {% endif %}
      <div class="options displayNone"></div>
      <a href="{{item.1}}">{{item.0}}</a>
    </td>
    {% if table.endrow %}
  </tr>
  {% endif %}
  {% endtable %}
</table>

{% endblock %}


{% block mdscontent %}
<div id="mds-path-breadcrumb">{{path_breadcrumbs|safe}}</div>
{% block node_error %}{% endblock %}
{% block node_data %}
{% endblock %}
{% endblock %}

{% block mdsmeta %}
{% if filter_list %}
<h3>applied filters<h3>{% for applied_filter in filter_list %}{{applied_filter|safe}}{% endfor %}
{% endif %}
<h3>views </h3>{% for node_view_name, node_view_link in f_node_views %}<a href="{{node_view_link}}">{{node_view_name}}</a> {% endfor %}
<h3>filters</h3>{% for fdict in f_node_filters %}{{fdict.t|safe}}{% endfor%}
{% endblock mdsmeta%}


{% block extrascript %}
{% comment %}TODO: Move from here? this will get overridden by javascript from signal view.{% endcomment %}

{% if input_tree %}
<script>
function updateLatestShot() {
 $.getJSON('/mdsplus/latest_shot/{{input_tree}}/', function(d){
 $(".latest_shot").text(d.latest_shot);
 }); // end getJSON
} // end function

function autoUpdate() {
setInterval(updateLatestShot, 2000);
}

$(document).ready(function() {
updateLatestShot();
autoUpdate();
});

</script>
{% endif %}
{% endblock %}
